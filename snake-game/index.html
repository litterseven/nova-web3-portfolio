<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Snake Mobile</title>
  <style>
    :root{--bg:#0b1020;--panel:#121a33;--text:#eef2ff;--muted:#aab4d6;--accent:#6ee7b7;--danger:#fb7185}
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    body{margin:0;background:radial-gradient(1200px 700px at 20% -20%,#263a7a 0,#0b1020 50%),#0b1020;color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;min-height:100vh;display:flex;justify-content:center}
    .wrap{width:min(96vw,520px);padding:16px 12px 24px;display:grid;gap:12px}
    .bar{display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);padding:10px 12px;border-radius:14px}
    .muted{color:var(--muted);font-size:13px}
    canvas{width:100%;aspect-ratio:1/1;background:linear-gradient(180deg,#101835,#0c132b);border:1px solid rgba(255,255,255,.14);border-radius:16px;box-shadow:0 20px 40px rgba(0,0,0,.35)}
    .controls{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;user-select:none}
    button{border:none;border-radius:12px;padding:12px 0;background:rgba(255,255,255,.1);color:#fff;font-weight:700;font-size:16px}
    button:active{transform:scale(.98)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .start{background:linear-gradient(135deg,#22c55e,#14b8a6)}
    .restart{background:linear-gradient(135deg,#ef4444,#f97316)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="bar">
      <div>ğŸ Snake</div>
      <div class="muted">åˆ†æ•° <b id="score">0</b></div>
    </div>
    <canvas id="game" width="360" height="360"></canvas>
    <div class="controls">
      <div></div><button id="up">â†‘</button><div></div>
      <button id="left">â†</button><button id="down">â†“</button><button id="right">â†’</button>
    </div>
    <div class="row">
      <button class="start" id="start">å¼€å§‹/æš‚åœ</button>
      <button class="restart" id="restart">é‡å¼€</button>
    </div>
    <div class="muted">æ‰‹æœºç›´æ¥ç‚¹æ–¹å‘é”®å³å¯ç©ï¼›ä¹Ÿæ”¯æŒé”®ç›˜æ–¹å‘é”®ã€‚</div>
  </div>

<script>
(() => {
  const cvs = document.getElementById('game');
  const ctx = cvs.getContext('2d');
  const scoreEl = document.getElementById('score');
  const N = 18, cell = cvs.width / N;
  let snake, dir, nextDir, food, score, timer = null, running = false;

  const rand = () => Math.floor(Math.random()*N);
  const eq = (a,b)=>a.x===b.x&&a.y===b.y;

  function reset(){
    snake = [{x:9,y:9},{x:8,y:9},{x:7,y:9}];
    dir = {x:1,y:0}; nextDir = dir;
    score = 0; scoreEl.textContent = score;
    spawnFood(); draw();
  }

  function spawnFood(){
    do { food = {x:rand(), y:rand()}; } while (snake.some(s=>eq(s,food)));
  }

  function setDir(x,y){
    if (x===-dir.x && y===-dir.y) return;
    nextDir = {x,y};
  }

  function tick(){
    dir = nextDir;
    const head = {x:(snake[0].x+dir.x+N)%N, y:(snake[0].y+dir.y+N)%N};
    if (snake.some(s=>eq(s,head))){
      running=false; clearInterval(timer); timer=null;
      alert('æ¸¸æˆç»“æŸï¼Œå¾—åˆ†ï¼š'+score);
      return;
    }
    snake.unshift(head);
    if (eq(head,food)){ score+=10; scoreEl.textContent=score; spawnFood(); }
    else snake.pop();
    draw();
  }

  function drawGrid(){
    ctx.strokeStyle='rgba(255,255,255,.06)';
    for(let i=1;i<N;i++){
      ctx.beginPath(); ctx.moveTo(i*cell,0); ctx.lineTo(i*cell,cvs.height); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(0,i*cell); ctx.lineTo(cvs.width,i*cell); ctx.stroke();
    }
  }

  function draw(){
    ctx.clearRect(0,0,cvs.width,cvs.height);
    drawGrid();
    ctx.fillStyle='#fb7185';
    roundRect(food.x*cell+2, food.y*cell+2, cell-4, cell-4, 7); ctx.fill();
    snake.forEach((s,i)=>{
      ctx.fillStyle = i===0 ? '#6ee7b7' : '#22c55e';
      roundRect(s.x*cell+2, s.y*cell+2, cell-4, cell-4, 7); ctx.fill();
    });
  }

  function roundRect(x,y,w,h,r){
    ctx.beginPath();
    ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r);
    ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath();
  }

  function toggle(){
    if (!running){ running=true; timer=setInterval(tick,130); }
    else { running=false; clearInterval(timer); timer=null; }
  }

  document.getElementById('up').onclick=()=>setDir(0,-1);
  document.getElementById('down').onclick=()=>setDir(0,1);
  document.getElementById('left').onclick=()=>setDir(-1,0);
  document.getElementById('right').onclick=()=>setDir(1,0);
  document.getElementById('start').onclick=toggle;
  document.getElementById('restart').onclick=()=>{ if(timer){clearInterval(timer);timer=null;} running=false; reset(); };

  window.addEventListener('keydown',e=>{
    if(e.key==='ArrowUp') setDir(0,-1);
    if(e.key==='ArrowDown') setDir(0,1);
    if(e.key==='ArrowLeft') setDir(-1,0);
    if(e.key==='ArrowRight') setDir(1,0);
    if(e.key===' ') toggle();
  });

  let sx=0, sy=0;
  cvs.addEventListener('touchstart',e=>{const t=e.touches[0]; sx=t.clientX; sy=t.clientY;}, {passive:true});
  cvs.addEventListener('touchend',e=>{
    const t=e.changedTouches[0]; const dx=t.clientX-sx, dy=t.clientY-sy;
    if(Math.abs(dx)>Math.abs(dy)) setDir(dx>0?1:-1,0); else setDir(0,dy>0?1:-1);
  }, {passive:true});

  reset();
})();
</script>
</body>
</html>